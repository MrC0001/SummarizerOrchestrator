//- views/index.pug
extends layout

block content
  h1
    i.fas.fa-cogs(style="margin-right: 10px;")
    | Summarize a Transcript

  .container
    if error
      p.error-message= error

    form(action="/summarizeAll" method="post")
      .form-group
        label(for="transcriptSelect") Select a Transcript:
        select(name="transcriptSelect" id="transcriptSelect" required aria-label="Select Transcript")
          option(value="" disabled selected) -- Select Transcript --
          each transcript in transcripts
            option(value=transcript.id)= `ID ${transcript.id} - ${transcript.scenario}`

      .form-group
        label(for="transcriptText") Transcript:
        textarea(name="transcript" id="transcriptText" rows="10" required aria-label="Transcript")
          | Select transcript from dropdown.

      button(type="submit" class="btn-submit") Summarize

  .link-group
    a(href="/new" class="btn-link") Create New Transcript
    a(href="/update" class="btn-link") Update Transcript
    a(href="/delete" class="btn-link") Delete Transcript
    a(href="/summaries" class="btn-link") Browse Summaries

  script.
    document.addEventListener('DOMContentLoaded', function() {
      try {
        const transcripts = !{JSON.stringify(transcripts)};
        const transcriptSelect = document.getElementById('transcriptSelect');
        const transcriptText = document.getElementById('transcriptText');

        transcriptSelect.addEventListener('change', function() {
          const selectedId = parseInt(this.value);
          const selectedTranscript = transcripts.find(t => t.id === selectedId);

          // Autofill the transcript textarea
          if (selectedTranscript) {
            transcriptText.value = selectedTranscript.transcript;
          } else {
            transcriptText.value = '';
          }
        });
      } catch (error) {
        console.error("Error in transcript selection script:", error);
      }
    });
